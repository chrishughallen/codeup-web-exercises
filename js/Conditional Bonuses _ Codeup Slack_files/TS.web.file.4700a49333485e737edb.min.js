webpackJsonp([198],{10046:function(e,i){(function(){TS.registerModule("web.file",{file_id:null,file_loaded:new signals.Signal,onStart:function i(){TS.web.login_sig.add(TS.web.file.onLogin,TS.web.file,1);TS.web.space||TS.files.team_file_changed_sig.add(TS.web.file.teamFileChanged,TS.web.file);TS.files.team_file_comment_deleted_sig.add(TS.web.file.teamFileCommentDeleted,TS.web.file);TS.files.team_file_deleted_success_sig.add(e);TS.web.file.bindEvents()},bindEvents:function e(){$("body").on("click",".action_cog",function(e){TS.menu.file.startWithFileActions(e,TS.web.file.file_id)})},onLogin:function e(){if(TS.boot_data.file){var l=TS.files.upsertFile(TS.boot_data.file).file;TS.web.file.file_id=l.id}var n;n=TS.boot_data.file?Promise.all([TS.members.legacyEnsureMembersInDataArePresent(TS.boot_data.file),TS.bots.ensureBotsInDataArePresent(TS.boot_data.file)]):Promise.resolve();n.then(function(){if(TS.boot_data.file){TS.utility.makeSureAllExternalLinksAreRefererSafe($(".post_body"));var e=TS.files.getFileById(TS.web.file.file_id);var l;if("USLACKBOT"===e.user&&e.bot_id){l=TS.interop.bots.getBotById(e.bot_id);l.is_bot=true;l.is_service=true}else l=TS.interop.members.getMemberById(e.user);$(".file_header_container").html(TS.templates.file_header({file:e,download:"hosted"===e.mode,member:l,is_post:"space"===e.mode||"post"===e.mode,preview:true}));if("email"===e.mode){var n={file:e,show_file_actions_cog:false,to_more_count:e.to.length-1,cc_more_count:e.cc.length-1};$("#file_page_email").html(TS.templates.file_email(n))}$(".star").bind("click.file",TS.stars.checkForStarClick);$("#file_public_link_revoker").bind("click",function(){TS.web.file.revokePublicURL(e)});$("#post_share_btn").on("click",function(){TS.ui.share_dialog.start(TS.web.file.file_id)});TS.web.comments&&!TS.web.space&&TS.files.fetchFileInfo(e.id,function(e,i){TS.web.comments.renderComments(i)})}_.get(TS,"files.media")&&TS.files.media.bindVideoElements({onCanplay:i,onError:t});$("#snippet_expand_toggle").on("click",function(){$(this).find("i").toggleClass("hidden");$("#page_contents").toggleClass("full_width");var e;e=!TS.prefs.getPref("expand_snippets");TS.prefs.setPrefLocal("expand_snippets",e);TS.prefs.setPrefByAPI({name:"expand_snippets",value:e})});$(".guide_toggle").on("click",function(){$("#formatting_col").toggleClass("hidden");$("#post_col").toggleClass("span_4_of_6 span_1_of_1");$(".guide_toggle").toggleClass("hidden");var e;e=!TS.prefs.getPref("posts_formatting_guide");TS.prefs.setPrefLocal("posts_formatting_guide",e);TS.prefs.setPrefByAPI({name:"posts_formatting_guide",value:e})});setTimeout(function(){$("#title").focus()},0)})},revokePublicURL:function e(i){var t=TS.interop.i18n.t("Revoke public file link","files")();var l="<p>"+TS.interop.i18n.t("This will disable the Public Link for this file, and will cause any previously shared links to stop working.","files")()+"</p>";l+=TS.interop.i18n.t("Are you sure you want to revoke this public link?","files")();if(TS.boot_data.feature_external_files){t=TS.interop.i18n.t("Revoke external file link","files")();l="<p>"+TS.interop.i18n.t("This will disable the External Link for this file, and will cause any previously shared links to stop working.","files")()+"</p>";l+=TS.interop.i18n.t("Are you sure you want to revoke this external link?","files")()}TS.generic_dialog.start({title:t,body:l,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Revoke it","files")(),go_button_class:"btn_warning",onGo:function e(){$(".file_public_link_shared").slideToggle(100);TS.files.upsertAndSignal({id:i.id,public_url_shared:false});var t=function e(i,t){if(t.file){TS.files.upsertAndSignal(t.file);TS.files.user_changed_public_url_sig.dispatch(t.file)}};return TS.api.callImmediately("files.revokePublicURL",{file:i.id}).then(function(e){var i=e.data,l=e.args,n=e.request_id;var s=true;t(s,i,l,n);return{data:i,args:l,request_id:n}}).catch(function(e){var i=e.data,l=e.args,n=e.request_id;var s=false;t(s,i,l,n);return{data:i,args:l,request_id:n}})}})},teamFileChanged:function e(i){$(".file_public_link").attr("href",i.permalink_public);i.public_url_shared?$(".file_public_link_shared").slideDown(100):$(".file_public_link_shared").slideUp(100);var t=TS.emoji.graphicReplace(i.title);$("#file_title").html(t);TS.web.comments.renderComments(i)},teamFileCommentDeleted:function e(i,t){TS.ui.comments.removeFileComment(i,t)},onPostShare:function e(i,t,l){var n=TS.redux.channels.getEntityById(l.channel);var s=n.name;n.is_channel&&(s="#"+n.name);var o=$('<p id="file_share_alert" class="alert alert_success no_print"><i class="ts_icon ts_icon_check_circle_o"></i> File shared to <a href="/archives/'+n.id+'">'+s+"</a>.</p>");$("#file_share_alert").length?$("#file_share_alert").replaceWith(o):$(".alert_container").append(o);$("#draft_mode_alert").remove();$("#post_status_draft").remove();n.is_channel&&$("#post_status_private").remove()},deleteFile:function e(i){var t;var l;var n;var s=TS.files&&TS.files.getFileById?TS.files.getFileById(i):null;if(s&&s.filetype&&"space"===s.filetype){t=TS.interop.i18n.t("Delete post","files")();l=TS.interop.i18n.t("Are you sure you want to delete this post permanently?","files")();n=TS.interop.i18n.t("Yes, delete this post","files")()}else{t=TS.interop.i18n.t("Delete file","files")();l=TS.interop.i18n.t("Are you sure you want to delete this file permanently?","files")();n=TS.interop.i18n.t("Yes, delete this file","files")()}TS.generic_dialog.start({title:t,body:l,show_cancel_button:true,show_go_button:true,go_button_class:"btn_danger",go_button_text:n,cancel_button_text:TS.interop.i18n.t("Cancel","files")(),onGo:function e(){TS.api.call("files.delete",{file:i}).then(function(e){var i=e.data,t=e.args,l=e.request_id;var n=true;TS.web.file.onFileDelete&&TS.web.file.onFileDelete(n,i,t,l);return{data:i,args:t,request_id:l}}).catch(function(e){var i=e.data,t=e.args,l=e.request_id;var n=false;TS.web.file.onFileDelete&&TS.web.file.onFileDelete(n,i,t,l);return{data:i,args:t,request_id:l}})}})},onFileDelete:function e(i,t,l){if(!i){TS.generic_dialog.alert(TS.interop.i18n.t("There was a problem deleting this file. Please try again.","files")());return}TS.files.team_file_deleted_success_sig.dispatch(l.file)},test:function i(){return{_teamFileDeleted:e}}});var e=function e(i){if(i!=TS.web.file.file_id)return;if(TS.web&&TS.web.space&&TS.web.space.isAutomaticDeleteInProcess())return;TS.generic_dialog.start({body:"<p>"+TS.interop.i18n.t("This file has been deleted!","files")()+"</p>",show_cancel_button:false,esc_for_ok:true,onGo:function e(){var i=null!=TSSSB.env.desktop_app_version;i?window.close():document.location.replace("/files")},unique:"file_deleted_"+i})};var i=function e(i){i.parent().removeClass("span_1_of_2");i.removeClass("hidden")};var t=function e(i){i.closest(".filetype_button_web").removeClass("hidden")}})()}},[10046]);