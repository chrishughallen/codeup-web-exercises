webpackJsonp([202],{10045:function(e,t){(function(){TS.registerModule("web.comments",{onStart:function e(){TS.web.comments.bindForm($("#file_comment_form"))},submitFileComment:function e(){var t=$(".file_comment_submit_btn");var n=$("#file_comment_form #file_comment");var i=TS.utility.contenteditable.value(n);var o=TS.format.cleanMsg(i);if(!$.trim(o))return;var a=TS.files.getFileById(TS.web.file.file_id);var m=a.id;var r;var c=TS.ui.needToBlockAtChannelKeyword(i,a);if(c){TS.generic_dialog.alert("<p>"+TS.interop.i18n.t("A Workspace Owner has restricted the use of <strong>{at_channel_key_word}</strong> messages.","comments")({at_channel_key_word:_.escape(c)}));return}var l;TS.utility.contenteditable.clear(n);TS.utility.contenteditable.clearHistory(n);void 0===t.data("ladda")&&t.data("ladda",Ladda.create(t[0]));t.data("ladda").start();TS.files.addComment(m,o,r,function(e,o,r){if(e)TS.files.fetchFileInfo(a.id,function(e,n){TS.web.comments.renderComments(n);if(o.comment.id){window.location.hash&&history&&history.pushState&&history.pushState({},"","#"+o.comment.id);l=$("#"+o.comment.id);l&&l.scrollintoview()}t.data("ladda").stop()});else{alert(TS.interop.i18n.t("error: comment not added to file","comments")());r.file==m&&TS.utility.contenteditable.value(n,i)}})},bindForm:function e(t){t.bind("submit",function(e){e.preventDefault();TS.web.comments.submitFileComment();return false})},renderCommentsIfNotYetRendered:function t(n){if(e)return;e=true;TS.web.comments.renderComments(n)},renderComments:function e(t){var n={};var i;n.file=t;i=$("#file_page_comments");i.html(TS.templates.comments(n));i.unbind("click.comments").bind("click.comments",function(e){TS.stars.checkForStarClick(e);TS.rxns.checkForRxnClick(e);var t=$(e.target);var n=t.closest(".comment_actions");if(1==n.length){TS.info("click on child of .comment_actions");if(t.hasClass("comment_cog")){e.preventDefault();TS.menu.startWithCommentActions(e,n.data("file-id"),n.data("comment-id"))}}});$(".file_comment_tip").html(TS.templates.builders.makeFileCommentHelpHTML(t));if(window.location.hash){var o=$(window.location.hash);var a=92;$(window).scrollTop(o.offset().top-a)}}});var e=false})()}},[10045]);